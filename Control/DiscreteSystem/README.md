# 離散時間システム

## 離散時間システムの導出

### 連続時間伝達関数から離散時間伝達関数への変換

以下は美多 勉 先生、原 辰次 先生、近藤 良 先生の「基礎ディジタル制御」（コロナ社）参考（特にp.p.112以降の「ディジタル再設計」に基づく）

離散時間システムを離散時間システムとして実装する場合の比較的簡便な実装手法に、連続時間で設計した伝達関数を離散時間伝達関数に変換する手法がある。
なお本手法では近似的に連続時間伝達関数を離散時間伝達関数に変換するので、連続時間で得られる性能が厳密には得られなくなってしまうことに注意する必要がある。

連続時間変数$s$を、離散時間変数$z[k]$に変換する近似式を以下に3つ記す。
なお近似式の導出にはある信号値$u$、制御周期$T_u$、インデックス$k$を用いる。

1. 後退差分方式

後退差分方式は、ある値$u$の微分値を後退差分値として1次近似する手法であり、
$$
\frac{\text{d}u}{\text{d}t} \approx \frac{u[k]-u[k-1]}{T_u}
$$
$$
\therefore \quad s\ u(s) = u[k] \frac{1-z^{-1}}{T_u}
$$
より$s$と$z$の関係式を
$$
s = \frac{z-1}{T_u z}
$$
と近似する。

2. 前進差分方式

前進差分方式は、ある値$u$の微分値を前進差分値として1次近似する手法であり、
$$
\frac{\text{d}u}{\text{d}t} \approx \frac{u[k+1]-u[k]}{T_u}
$$
$$
\therefore \quad s\ u(s) = u[k] \frac{z-1}{T_u}
$$
より$s$と$z$の関係式を
$$
s = \frac{z-1}{T_u}
$$
と近似する。

3. 双一次変換（タスティン変換）

双一次変換は、ある値$u$の積分値を台形近似する手法であり、その出力を$y$とすると、
$$
y[k+1] = y[k] + T_u \frac{u[k+1]+u[k]}{2}
$$
より$s$と$z$の関係式を
$$
s = \frac{2}{T_u} \frac{z-1}{z+1}
$$
と近似する。

以下では連続時間伝達関数の離散時間伝達関数への変換例、そのC言語における実装例について述べる。
なお以下では元の連続時間伝達関数の安定性を比較的保存しやすい双一次変換を用いる。

ある入力$u$から出力$y$への連続時間伝達関数
$$
G(s) = \frac{\omega_n^2}{s^2 + 2\zeta_n \omega_n s + \omega_n^2}
$$
を、ある入力$u[k]$から出力$y[k]$への離散時間伝達関数$G(z)$に変換することを考える。
$s = \frac{2}{T_u} \frac{z-1}{z+1}$を$G(s)$に代入すれば良く、
$$
\frac{y[k]}{u[k]} = \frac{\omega_n^2}{\left( \frac{2}{T_u} \frac{z-1}{z+1} \right)^2 + 2\zeta_n \omega_n \left( \frac{2}{T_u} \frac{z-1}{z+1} \right) + \omega_n^2}
$$
$$
\therefore \quad \frac{y[k]}{u[k]} = \frac{b_2 z^2 + b_1 z + b_0}{a_2 z^2 + a_1 z + a_0} \quad \tag{1}
$$
と変形できる。
ただし$a_0$, $a_1$, $a_2$, $b_0$, $b_1$, $b_2$は計算により導出される係数である。
なおMATLABの場合は以下の通りに関数c2dを使用し、計算される離散時間伝達関数Qdの係数を確認することで$a_0$, $a_1$, $a_2$, $b_0$, $b_1$, $b_2$を求められる（$\zeta_n$, $\omega_n$は適当なパラメータとする）。
```
s = tf('s');
zeta_n = 0.1;
omega_n = 2*pi*50;

Tu = 1e-3; % Control period [s]
Qc = omega_n^2 / (s^2+2*zeta_n*omega_n*s+omega_n^2);
Qd = c2d(Qc, Tu, 'tustin');

```

式(1)の分母をはらうと、
$$
\left( a_2 z^2 + a_1 z + a_0 \right) y[k] = \left( b_2 z^2 + b_1 z + b_0 \right) u[k]
$$
$$
\therefore \quad a_2 y[k+2] + a_1 y[k+1] + a_0 y[k] = b_2 u[k+2] + b_1 u[k+1] b_0
$$
$$
\therefore \quad y[k+2] = -\frac{a_1}{a_2} y[k+1] -\frac{a_0}{a_2} y[k] + \frac{b_2}{a_2} u[k+2] + \frac{b_1}{a_2} u[k+1] + \frac{b_0}{a_2} u[k]
$$
となる。
$u[0]$, $u[1]$, $y[0]$, $y[1]$を適当な値に設定し、$y[2]$以降を決定することで所望の離散時間伝達関数をC言語として実装することができる。
計算のとき、$a_0$, $a_1$, $a_2$, $b_0$, $b_1$, $b_2$を小数点以下可能な限り細かく取得することがより精度の良い計算のために必要である。